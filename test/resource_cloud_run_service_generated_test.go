// ----------------------------------------------------------------------------
//
//     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
//
// ----------------------------------------------------------------------------
//
//     This file is automatically generated by Magic Modules and manual
//     changes will be clobbered when the file is regenerated.
//
//     Please read more about how to change this file in
//     .github/CONTRIBUTING.md.
//
// ----------------------------------------------------------------------------

package test

import (
	"io/ioutil"
	"log"
	"os"
	"path"
	"testing"
)

func TestAccCloudRunService_cloudRunServiceBasicExample_generated_offline(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceBasicExample_offline"
	offline := true
	testAccCloudRunService_cloudRunServiceBasicExample_shared(t, testSlug, offline)
}

func TestAccCloudRunService_cloudRunServiceBasicExample_generated_online(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceBasicExample_online"
	offline := false
	testAccCloudRunService_cloudRunServiceBasicExample_shared(t, testSlug, offline)
}

func testAccCloudRunService_cloudRunServiceBasicExample_shared(t *testing.T, testSlug string, offline bool) {
	if testing.Short() {
		t.Skip("skipping integration test in short mode.")
		return
	}

	t.Parallel()
	context := map[string]interface{}{
		"project":       getTestProjectFromEnv(),
		"random_suffix": "meepmerp", // true randomization isn't needed for validator
	}

	terraformConfig := getTestPrefix() + testAccCloudRunService_cloudRunServiceBasicExample(context)
	dir, err := ioutil.TempDir(tmpDir, "terraform")
	if err != nil {
		log.Fatal(err)
	}
	defer os.RemoveAll(dir)

	dstFile := path.Join(dir, "main.tf")
	err = os.WriteFile(dstFile, []byte(terraformConfig), 0666)
	if err != nil {
		t.Fatalf("error while writing to file %s, error %v", dstFile, err)
	}

	terraformWorkflow(t, dir, testSlug)
	if offline && shouldOutputGeneratedFiles() {
		generateTFVconvertedAsset(t, dir, testSlug)
		return
	}

	// need to have comparison.. perhaps test vs checked in code
	// testConvertCommand(t, dir, c.name, offline, c.compareConvertOutput)

	testValidateCommandGeneric(t, dir, testSlug, offline, true)
}

func testAccCloudRunService_cloudRunServiceBasicExample(context map[string]interface{}) string {
	return Nprintf(`
resource "google_cloud_run_service" "default" {
  name     = "tf-test-cloudrun-srv%{random_suffix}"
  location = "us-central1"

  template {
    spec {
      containers {
        image = "us-docker.pkg.dev/cloudrun/container/hello"
      }
    }
  }

  traffic {
    percent         = 100
    latest_revision = true
  }
}
`, context)
}

func TestAccCloudRunService_cloudRunServiceSqlExample_generated_offline(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceSqlExample_offline"
	offline := true
	testAccCloudRunService_cloudRunServiceSqlExample_shared(t, testSlug, offline)
}

func TestAccCloudRunService_cloudRunServiceSqlExample_generated_online(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceSqlExample_online"
	offline := false
	testAccCloudRunService_cloudRunServiceSqlExample_shared(t, testSlug, offline)
}

func testAccCloudRunService_cloudRunServiceSqlExample_shared(t *testing.T, testSlug string, offline bool) {
	if testing.Short() {
		t.Skip("skipping integration test in short mode.")
		return
	}

	t.Parallel()
	context := map[string]interface{}{
		"deletion_protection": false,
		"random_suffix":       "meepmerp", // true randomization isn't needed for validator
	}

	terraformConfig := getTestPrefix() + testAccCloudRunService_cloudRunServiceSqlExample(context)
	dir, err := ioutil.TempDir(tmpDir, "terraform")
	if err != nil {
		log.Fatal(err)
	}
	defer os.RemoveAll(dir)

	dstFile := path.Join(dir, "main.tf")
	err = os.WriteFile(dstFile, []byte(terraformConfig), 0666)
	if err != nil {
		t.Fatalf("error while writing to file %s, error %v", dstFile, err)
	}

	terraformWorkflow(t, dir, testSlug)
	if offline && shouldOutputGeneratedFiles() {
		generateTFVconvertedAsset(t, dir, testSlug)
		return
	}

	// need to have comparison.. perhaps test vs checked in code
	// testConvertCommand(t, dir, c.name, offline, c.compareConvertOutput)

	testValidateCommandGeneric(t, dir, testSlug, offline, true)
}

func testAccCloudRunService_cloudRunServiceSqlExample(context map[string]interface{}) string {
	return Nprintf(`
resource "google_cloud_run_service" "default" {
  name     = "tf-test-cloudrun-srv%{random_suffix}"
  location = "us-central1"

  template {
    spec {
      containers {
        image = "us-docker.pkg.dev/cloudrun/container/hello"
      }
    }

    metadata {
      annotations = {
        "autoscaling.knative.dev/maxScale"      = "1000"
        "run.googleapis.com/cloudsql-instances" = google_sql_database_instance.instance.connection_name
        "run.googleapis.com/client-name"        = "terraform"
      }
    }
  }
  autogenerate_revision_name = true
}

resource "google_sql_database_instance" "instance" {
  name             = "tf-test-cloudrun-sql%{random_suffix}"
  region           = "us-east1"
  database_version = "MYSQL_5_7"
  settings {
    tier = "db-f1-micro"
  }

  deletion_protection  = "%{deletion_protection}"
}
`, context)
}

func TestAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_generated_offline(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_offline"
	offline := true
	testAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_shared(t, testSlug, offline)
}

func TestAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_generated_online(t *testing.T) {
	testSlug := "CloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_online"
	offline := false
	testAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_shared(t, testSlug, offline)
}

func testAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample_shared(t *testing.T, testSlug string, offline bool) {
	if testing.Short() {
		t.Skip("skipping integration test in short mode.")
		return
	}

	t.Parallel()
	context := map[string]interface{}{
		"project":       getTestProjectFromEnv(),
		"random_suffix": "meepmerp", // true randomization isn't needed for validator
	}

	terraformConfig := getTestPrefix() + testAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample(context)
	dir, err := ioutil.TempDir(tmpDir, "terraform")
	if err != nil {
		log.Fatal(err)
	}
	defer os.RemoveAll(dir)

	dstFile := path.Join(dir, "main.tf")
	err = os.WriteFile(dstFile, []byte(terraformConfig), 0666)
	if err != nil {
		t.Fatalf("error while writing to file %s, error %v", dstFile, err)
	}

	terraformWorkflow(t, dir, testSlug)
	if offline && shouldOutputGeneratedFiles() {
		generateTFVconvertedAsset(t, dir, testSlug)
		return
	}

	// need to have comparison.. perhaps test vs checked in code
	// testConvertCommand(t, dir, c.name, offline, c.compareConvertOutput)

	testValidateCommandGeneric(t, dir, testSlug, offline, true)
}

func testAccCloudRunService_cloudRunServiceMultipleEnvironmentVariablesExample(context map[string]interface{}) string {
	return Nprintf(`
resource "google_cloud_run_service" "default" {
  name     = "tf-test-cloudrun-srv%{random_suffix}"
  location = "us-central1"

  template {
    spec {
      containers {
        image = "us-docker.pkg.dev/cloudrun/container/hello"
        env {
          name = "SOURCE"
          value = "remote"
        }
        env {
          name = "TARGET"
          value = "home"
        }
      }
    }
  }

  metadata {
    annotations = {
      generated-by = "magic-modules"
    }
  }

  traffic {
    percent         = 100
    latest_revision = true
  }
  autogenerate_revision_name = true

  lifecycle {
    ignore_changes = [
        metadata.0.annotations,
    ]
  }
}
`, context)
}
